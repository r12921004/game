<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>地牢觸控遊戲</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    touch-action: none;
    color: white;
    font-family: sans-serif;
  }

  #game {
    background: #222;
    border: 8px solid #555;
    width: 90vmin;
    height: 90vmin;
    position: relative;
    border-radius: 12px;
    box-shadow: 0 0 30px #000 inset;
  }

  #player {
    position: absolute;
    width: 40px;
    height: 40px;
    background: #4ff;
    border-radius: 50%;
    transform: translate(-20px, -20px);
  }

  .corner {
    width: 50px;
    height: 50px;
    background: #333;
    border-radius: 10px;
    position: absolute;
  }

  .active {
    background: #5f5 !important;
  }

  #msg {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 20px;
    opacity: 0;
    transition: 0.5s;
  }
</style>
</head>
<body>

<div id="game">
  <div id="msg">通關！</div>
  
  <div id="player"></div>

  <!-- 四角位置 -->
  <div class="corner" id="c1" style="left:0; top:0;"></div>
  <div class="corner" id="c2" style="right:0; top:0;"></div>
  <div class="corner" id="c3" style="left:0; bottom:0;"></div>
  <div class="corner" id="c4" style="right:0; bottom:0;"></div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const msg = document.getElementById("msg");
const corners = [
  document.getElementById("c1"),
  document.getElementById("c2"),
  document.getElementById("c3"),
  document.getElementById("c4")
];

let p = { x: 150, y: 150 };
let touching = false;

// 限制在地牢內
function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

// 觸碰判定
function checkCorners() {
  corners.forEach((c, i) => {
    const rect = c.getBoundingClientRect();
    const r = player.getBoundingClientRect();

    const overlap =
      r.left < rect.right &&
      r.right > rect.left &&
      r.top < rect.bottom &&
      r.bottom > rect.top;

    if (overlap) c.classList.add("active");
  });

  // 是否全亮
  if ([...corners].every(c => c.classList.contains("active"))) {
    msg.style.opacity = 1;
  }
}

// 手機觸控移動
game.addEventListener("touchstart", (e) => {
  touching = true;
});
game.addEventListener("touchend", () => {
  touching = false;
});

// 移動跟著手指
game.addEventListener("touchmove", (e) => {
  e.preventDefault();
  if (!touching) return;

  const t = e.touches[0];
  const rect = game.getBoundingClientRect();

  // 手指在地牢中的位置
  p.x = clamp(t.clientX - rect.left, 0, rect.width);
  p.y = clamp(t.clientY - rect.top, 0, rect.height);

  player.style.left = p.x + "px";
  player.style.top = p.y + "px";

  checkCorners();
});
</script>

</body>
</html>
